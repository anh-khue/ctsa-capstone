<!DOCTYPE html>
<html lang="vn">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible"
          content="IE=edge">
    <title>Kết quả</title>
    <meta name="viewport"
          content="width=device-width, initial-scale=1">

    <link rel="stylesheet"
          href=".\css\result.css">
    <!-- Bootstrap -->
    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans"
          rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
          rel="stylesheet">
    <link rel="stylesheet"
          href="./css/style.css">
    <!-- <link rel="stylesheet"
          href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet"
          href="/resources/demos/style.css"> -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
    <script src="js/get-suggestions.js"></script>
    <!-- <link href="https://fonts.googleapis.com/css?family=Muli" rel="stylesheet">  -->
</head>

<body>
    <!-- Header -->
    <nav class="navbar navbar-expand-md navbar-dark bg-dark"
         style="height: 45px">
        <a class="navbar-brand"
           href=".\index-ctsa.html">
            <img src="./images/logoctsa.png"
                 width="90"
                 height="30"
                 class="d-inline-block align-top"
                 alt="CTSA logo">
        </a>
        <div class="collapse navbar-collapse justify-content-center menu "
             id="navbarSupportedContent">
            <a class="mx-5"
               href="#">Tuyển Dụng</a>
            <a class="mx-5"
               href=".\graph.html">Thống Kê</a>
            <a class="mx-5"
               href="#">Tuyển Dụng</a>
            <a class="mx-5"
               href="#">Thống Kê</a>
        </div>
        <span class="fa-stack">
            <i class="	fa fa-user-circle-o fa-stack-1x"
               style="font-size:36px; color:white"></i>
        </span>
    </nav>
    <!-- End of Header -->

    <div class="container-fluid">
        <div id="content-result"
             class="tab-content col-md-12 folder text-center">
            <div class="text-center pt-3">
                <h2>Chào bạn!</h2>
                <h4>Dựa theo thông tin bạn cung cấp</h4>
                <h4>Đây là các ngành nghề có thể phù hợp nhất dành cho bạn</h4>

                <!-- Button trigger modal -->
                <button type="button"
                        class="btn btn-lg selected"
                        data-toggle="modal"
                        data-target="#scoreInputModal">
                    Bạn muốn nhận gợi ý chính xác hơn?
                </button>
            </div>
            <div class="row justify-content-around">
                <div id="suggest2"
                     class="col-md-3 text-center result"
                     style="pointer-events: auto;">
                    <span style="font-size: 45px; color:#ff6414">2</span>
                </div>
                <div id="suggest1"
                     class="col-md-3 text-center result"
                     style="pointer-events: auto;">
                    <span style="font-size: 45px; color:#ff6414">1</span>

                    <br>
                    <br>
                    <br>
                    <div class="job-result">
                        <b style="font-size:2em;color:rgb(235, 231, 231);">Công nghệ thông tin</b>
                    </div>
                    <br>
                    <br>
                    <br>
                    <br>



                </div>
                <div id="suggest3"
                     class="col-md-3 text-center result"
                     style="pointer-events: auto;">
                    <span style="font-size: 45px; color:#ff6414">3</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade"
         id="scoreInputModal"
         tabindex="-1"
         role="dialog"
         aria-labelledby="scoreInputModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg"
             role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"
                        id="scoreInputModalLabel">Vui lòng chọn điểm thi Đại học dự tính của bạn phía bên dưới</h5>
                    <button type="button"
                            class="close"
                            data-dismiss="modal"
                            aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="row modal-body justify-content-between">
                    <div class="col-md-6 pl-4"
                         style="border-right: 1px solid grey">
                        <div id="mathMark">
                            <span>Toán học:</span>
                            <input class="rangeValues">
                            <section style="padding-bottom:20px"
                                     class="range-slider">
                                <input value="5"
                                       min="0"
                                       max="10"
                                       step="0.1"
                                       type="range">
                                <input value="10"
                                       min="0"
                                       max="10"
                                       step="0.1"
                                       type="range">
                            </section>
                        </div>
                        <hr>
                        <div id="literatureMark">
                            <span>
                                Ngữ Văn:
                            </span>
                            <input class="rangeValues">
                            <section style="padding-bottom:20px"
                                     class="range-slider">
                                <input value="5"
                                       min="0"
                                       max="10"
                                       step="0.1"
                                       type="range">
                                <input value="10"
                                       min="0"
                                       max="10"
                                       step="0.1"
                                       type="range">
                            </section>
                        </div>
                        <hr>
                        <div id="englishMark">
                            <span>
                                Anh Văn:
                            </span>
                            <input class="rangeValues">
                            <section style="padding-bottom:20px"
                                     class="range-slider">
                                <input value="5"
                                       min="0"
                                       max="10"
                                       step="0.1"
                                       type="range">
                                <input value="10"
                                       min="0"
                                       max="10"
                                       step="0.1"
                                       type="range">
                            </section>
                        </div>
                        <hr>
                        <div id="physicsMark">
                            <span>
                                Vật lý:
                            </span>
                            <input class="rangeValues">
                            <section style="padding-bottom:20px"
                                     class="range-slider">
                                <input value="5"
                                       min="0"
                                       max="10"
                                       step="0.1"
                                       type="range">
                                <input value="10"
                                       min="0"
                                       max="10"
                                       step="0.1"
                                       type="range">
                            </section>
                        </div>
                    </div>
                    <hr>
                    <div class="col-md-6 pl-4">
                        <div id="chemistryMark">
                            <span>Hóa học:</span>
                            <input class="rangeValues">
                            <section style="padding-bottom:20px"
                                     class="range-slider">
                                <input value="5"
                                       min="0"
                                       max="10"
                                       step="0.1"
                                       type="range">
                                <input value="10"
                                       min="0"
                                       max="10"
                                       step="0.1"
                                       type="range">
                            </section>
                        </div>
                        <hr>
                        <div id="biologyMark">
                            <span>
                                Sinh học:
                            </span>
                            <input class="rangeValues">
                            <section style="padding-bottom:20px"
                                     class="range-slider">
                                <input value="5"
                                       min="0"
                                       max="10"
                                       step="0.1"
                                       type="range">
                                <input value="10"
                                       min="0"
                                       max="10"
                                       step="0.1"
                                       type="range">
                            </section>
                        </div>
                        <hr>
                        <div id="historyMark">
                            <span>
                                Lịch sử:
                            </span>
                            <input class="rangeValues">
                            <section style="padding-bottom:20px"
                                     class="range-slider">
                                <input value="5"
                                       min="0"
                                       max="10"
                                       step="0.1"
                                       type="range">
                                <input value="10"
                                       min="0"
                                       max="10"
                                       step="0.1"
                                       type="range">
                            </section>
                        </div>
                        <hr>
                        <div id="geographyMark">
                            <span>
                                Địa lý:
                            </span>
                            <input class="rangeValues"
                                   id="testMathMark">
                            <section style="padding-bottom:20px"
                                     class="range-slider">
                                <input value="5"
                                       min="0"
                                       max="10"
                                       step="0.1"
                                       type="range">
                                <input value="10"
                                       min="0"
                                       max="10"
                                       step="0.1"
                                       type="range">
                            </section>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button"
                            class="btn btn-secondary"
                            data-dismiss="modal">Huỷ</button>
                    <button type="button"
                            class="btn selected"
                            onclick='getSuggestions()'>Nhận thêm gợi ý</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade"
         id="JobDescriptionModal"
         tabindex="-1"
         role="dialog"
         aria-labelledby="JobDescriptionModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg"
             role="document">
            <div class="modal-content">
                <div class="modal-header text-center">
                    <h5 class="modal-title"
                        id="scoreInputModalLabel">
                        <span style="font-size:1.5em">Mô tả</span><br>
                        Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
                        eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis
                        nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</h5>

                </div>
                <div class="modal-body">
                    <div class="row text-center">
                        <div class="col-md-12 ml-3">
                            <h2>Mức lương khởi điểm</h2>
                        </div>
                    </div>
                    <div class="row">
                        <div id="triangle"></div>
                        <div class="row banner-description justify-content-between my-auto"
                             style="font-size: 1.8em; font-style: italic">
                            <div class="col-md-3 my-4 ml-5"
                                 style="margin-top: 0.5rem!important">
                                <b id="latestSalary"
                                   style="color:rgb(240, 240, 240)">

                                </b>
                            </div>
                            <div class="col-md-2">
                                <img src="./images/money-icon.png"
                                     alt="Money Icon"
                                     width="155"
                                     height="155"
                                     style="margin-top:-25px; margin-bottom:-20px;">
                            </div>
                            <div class="col-md-3 my-4 mr-5"
                                 style="text-align: right; margin-top: 0.5rem!important">
                                <b id="predictedSalary">

                                </b>
                            </div>
                        </div>
                        <div id="triangle2"></div>
                    </div>
                    <div class="row justify-content-center text-center">
                        <div class="col-md-12 ml-3">
                            <h2>Tổng số nhân lực</h2>
                        </div>
                    </div>
                    <div class="row">
                        <div id="triangle"></div>
                        <div class="row banner-description justify-content-between my-auto"
                             style="font-size: 1.8em; font-style: italic">
                            <div class="col-md-3 my-4 ml-5"
                                 style="margin-top: 0.5rem!important">
                                <b id="latestHumanResource"
                                   style="color:rgb(240, 240, 240)">

                                </b>
                            </div>
                            <div class="col-md-2">
                                <img src="./images/human-resources.png"
                                     alt="Money Icon"
                                     width="155"
                                     height="155"
                                     style="margin-top:-25px; margin-bottom:-20px;">
                            </div>
                            <div class="col-md-3 my-4 mr-5"
                                 style="text-align: right; margin-top: 0.5rem!important">
                                <b id='predictedHumanResource'>

                                </b>
                            </div>
                        </div>
                        <div id="triangle2"></div>
                    </div>
                    <div class="row justify-content-center text-center">
                        <div class="col-md-12 ml-3">
                            <h2>Thông tin bổ sung</h2>
                        </div>
                    </div>
                    <div class="row">
                        <div id="triangle"></div>
                        <div class="row banner-description justify-content-between my-auto"
                             style="font-size: 1.8em; font-style: italic">
                            <div class="col-md-3 my-4 ml-5"
                                 style="margin-top: 0.5rem!important">
                                <b id="latestSupportingInfomation"
                                   style="color:rgb(240, 240, 240)">

                                </b>
                            </div>
                            <div class="col-md-2">
                                <img src="./images/additional.png"
                                     alt="Money Icon"
                                     width="155"
                                     height="155"
                                     style="margin-top:-25px; margin-bottom:-20px;">
                            </div>
                            <div class="col-md-3 my-4 mr-5"
                                 style="text-align: right; margin-top: 0.5rem!important">
                                <b id='predictSupportingInfomation'>

                                </b>
                            </div>
                        </div>
                        <div id="triangle2"></div>
                    </div>
                </div>
                <div class="modal-footer text-center">
                    <h5>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
                        eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis
                        nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</h5>
                </div>
            </div>
        </div>
    </div>

    <script>
        function getVals() {
            // Get slider values
            var parent = this.parentNode;
            var slides = parent.getElementsByTagName("input");
            //value to show range later
            var divParent = this.parentNode.parentNode;
            var inputValue = divParent.getElementsByTagName("input");

            // inputValue.value=slide1 + " - " + slide2;
            var slide1 = parseFloat(slides[0].value);
            var slide2 = parseFloat(slides[1].value);
            // Neither slider will clip the other, so make sure we determine which is larger
            if (slide1 > slide2) { var tmp = slide2; slide2 = slide1; slide1 = tmp; }

            var displayElement = document.getElementsByClassName("rangeValues")[2];
            // displayElement.value = slide1 + " - " + slide2;

            //In the div there are 3 input tag so I use the 1st input in the array 
            //- the one value we need to change
            inputValue[0].value = slide1 + " - " + slide2;

            //variable to store range value
            // var value = [slide1, slide2];
            // console.log(value);
        }

        window.onload = function () {
            // Initialize Sliders
            var sliderSections = document.getElementsByClassName("range-slider");
            for (var x = 0; x < sliderSections.length; x++) {
                var sliders = sliderSections[x].getElementsByTagName("input");
                for (var y = 0; y < sliders.length; y++) {
                    if (sliders[y].type === "range") {
                        sliders[y].oninput = getVals;
                        // Manually trigger event first time to display values
                        sliders[y].oninput();
                    }
                }
            }

            var suggestions = JSON.parse(sessionStorage.getItem('suggestions'));

            showSuggestions(suggestions)
        }

        function showSuggestions(suggestions) {
            for (var i = 0; i < 3;) {
                let suggestion = suggestions[i++]

                let suggestionDiv = $('#suggest' + i)
                // suggestionDiv.empty()
                suggestionDiv.attr('onclick', 'showInfoModal(' + suggestion.major.id + ')')

                // $('<span>', {
                //     class: 'fa fa-star',
                //     style: 'font-size: 45px; color:#ff6414'
                // }).appendTo(suggestionDiv)

                $('<br>').appendTo(suggestionDiv)
                $('<br>').appendTo(suggestionDiv)
               

                $('<b>', {
                    text: suggestion.major.vietnamese,
                    style: 'font-size:2em;color:rgb(235, 231, 231)'
                }).appendTo(suggestionDiv)

                $('<br>').appendTo(suggestionDiv)
                $('<br>').appendTo(suggestionDiv)
                $('<br>').appendTo(suggestionDiv)
                $('<br>').appendTo(suggestionDiv)

                $('<img>', {
                    src: suggestion.major.imageUrl,
                    alt: suggestion.major.vietnamese,
                    height: '180',
                    width: '180'
                }).appendTo(suggestionDiv)
            }
        }

        function showInfoModal(majorId) {
            let jobPredictionModal = $("#JobDescriptionModal")

            // Salary
            // Latest
            axios.get('http://localhost:8006/salaries/latest?majorId=' + majorId)
                .then((response) => {
                    let model = response.data
                    $('#latestSalary').html(numberWithCommas(model.actual) + '<br/>VNĐ')
                })
            // Prediction
            axios.get('http://localhost:8006/salaries/predictions?year=2021&majorId=' + majorId)
                .then((response) => {
                    let model = response.data
                    $('#predictedSalary').html(numberWithCommas(Math.round(model.forecast)) + '<br/>VNĐ')
                })

            // Human Resource
            // Latest
            axios.get('http://localhost:8006/human-resources/latest?majorId=' + majorId)
                .then((response) => {
                    let model = response.data
                    $('#latestHumanResource').html(numberWithCommas(model.actual) + '<br/>người')
                })
            // Prediction
            axios.get('http://localhost:8006/human-resources/predictions?year=2021&majorId=' + majorId)
                .then((response) => {
                    let model = response.data
                    $('#predictedHumanResource').html(numberWithCommas(Math.round(model.forecast)) + '<br/>người')
                })

            jobPredictionModal.modal("toggle");

            // Supporting Infomation
            // Latest
            axios.get('http://localhost:8006/supporting-information/latest?majorId=' + majorId)
                .then((response) => {
                    let model = response.data
                    $('#latestSupportingInfomation').html(numberWithCommas(model.actual) + '<br/>' + model.unit)
                })
            // Prediction
            axios.get('http://localhost:8006/supporting-information/predictions?year=2021&majorId=' + majorId)
                .then((response) => {
                    let model = response.data
                    $('#predictSupportingInfomation').html(numberWithCommas(Math.round(model.forecast)) + '<br/>' + model.unit)
                })

            jobPredictionModal.modal("toggle");
        }

        const numberWithCommas = (x) => {
            return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }
    </script>
</body>

</html>