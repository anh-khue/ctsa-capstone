<!DOCTYPE html>
<html lang="vn">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible"
        content="IE=edge">
  <title>Thống kê</title>
  <meta name="viewport"
        content="width=device-width, initial-scale=1">


  <!-- Bootstrap -->
  <link rel="stylesheet"
        href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
  <!-- <link href="https://fonts.googleapis.com/css?family=Muli" rel="stylesheet">  -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans"
        rel="stylesheet">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
        rel="stylesheet">
  <link rel="stylesheet"
        href=".\css\style.css">
  <link rel="stylesheet"
        href=".\css\tab.css">
</head>


<body>
  <!-- Header -->

  <nav class="navbar navbar-expand-md navbar-dark bg-dark"
       style="height: 45px">
    <a class="navbar-brand"
       href=".\index-ctsa.html">
      <img src="./images/logoctsa.png"
           width="90"
           height="30"
           class="d-inline-block align-top"
           alt="CTSA logo">
    </a>

    <div class="collapse navbar-collapse justify-content-center menu "
         id="navbarSupportedContent">
      <a class="mx-5"
         href="#">Tuyển Dụng</a>
      <a class="mx-5"
         href=".\graph.html">Thống Kê</a>
      <a class="mx-5"
         href="#">Tuyển Dụng</a>
      <a class="mx-5"
         href="#">Thống Kê</a>

    </div>
    <span class="fa-stack">
      <i class="	fa fa-user-circle-o fa-stack-1x"
         style="font-size:36px; color:white"></i>
    </span>
  </nav>
  <!-- End of Header -->
  <div class="container-fluid">
    <div class="row">
      <ul class="nav col-md-12"
          id="myTab"
          role="tablist">
        <li class="nav-item tab tabactive"
            id="tabhome">
          <a class="nav-link active"
             id="home-tab"
             data-toggle="tab"
             href="#home"
             role="tab"
             aria-controls="home"
             aria-selected="true">Tổng hợp</a>
        </li>
        <li class="nav-item tab"
            id="tabstat">
          <a class="nav-link"
             id="statistic-tab"
             data-toggle="tab"
             href="#statistic"
             role="tab"
             aria-controls="profile"
             aria-selected="false">Thống kê</a>
        </li>
        <li class="nav-item tab"
            id="tabrecruit">
          <a class="nav-link"
             id="recruit-tab"
             data-toggle="tab"
             href="#recruit"
             role="tab"
             aria-controls="contact"
             aria-selected="false">Tuyển dụng</a>
        </li>
      </ul>
    </div>
    <div class="row">
      <div id="content"
           class="tab-content col-md-12 folder">
        <div class="tab-pane fade show active"
             id="home"
             role="tabpanel"
             aria-labelledby="home-tab">



          <div class="col-md-9 top-3 top-left"
               data-toggle="modal"
               data-target="#skillModal">
            <div class="row justify-content-between">
              <div class="col-md-5 my-auto pl-5">
                <b style="color: white; font-size: 40px;font-style: italic">TOP<br>Ngôn ngữ lập trình</b>
              </div>
              <div class="col-md-6 row justify-content-around top-icons-left">
                <div class="col-md-3 text-center">
                  <img src="./images/skill1.png"
                       alt="Skill">
                  Java
                </div>
                <div class="col-md-3 text-center">
                  <img src="./images/skill2.svg"
                       alt="Skill">
                  JavaScript
                </div>
                <div class="col-md-3 text-center">
                  <img src="./images/spring.svg"
                       alt="Skill">
                  Spring
                </div>
              </div>
            </div>
          </div>

          <div class="left-triangle"></div>

          <div class="col-md-9 top-3 top-right">
            <div class="row justify-content-between">
              <div class="col-md-7 row justify-content-around top-icons-right">
                <div class="col-md-3 text-center">
                  <img src="./images/job2.png"
                       alt="Job">text
                </div>
                <div class="col-md-3 text-center">
                  <img src="./images/job1.png"
                       alt="Job">text
                </div>
                <div class="col-md-3 text-center">
                  <img src="./images/job.png"
                       alt="Job">text
                </div>
              </div>
              <div class="col-md-3 my-auto pr-5">
                <b style="color: white; font-size: 40px;font-style: italic">TOP<br>VỊ TRÍ</b>
              </div>
            </div>
          </div>

          <div class="right-triangle"></div>

          <div class="col-md-9 top-3 top-left">
            <div class="row justify-content-between">
              <div class="col-md-3 my-auto pl-5">
                <b style="color: white; font-size: 40px;font-style: italic">TOP<br>KỸ NĂNG</b>
              </div>
              <div class="col-md-7 row justify-content-around top-icons-left">
                <div class="col-md-3 text-center">
                  <img src="./images/skill1.png"
                       alt="Skill">
                  Java
                </div>
                <div class="col-md-3 text-center">
                  <img src="./images/skill2.svg"
                       alt="Skill">
                  JavaScript
                </div>
                <div class="col-md-3 text-center">
                  <img src="./images/spring.svg"
                       alt="Skill">
                  Spring
                </div>
              </div>
            </div>
          </div>

          <div class="left-triangle"></div>

        </div>
        <div class="tab-pane fade"
             id="statistic"
             role="tabpanel"
             aria-labelledby="profile-tab">
          <div class="row">
            <div class="col-md-4"
                 style="text-align: right">
              <img src="..\ctsa-capstone\images\java.png"
                   alt="Java"
                   height="60"
                   width="150"><br>
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
                dolore magna aliqua.</p>

            </div>
            <div class="col-md-2 text-center ">
              <div class="statistic1">
                <span style="color:rgb(235, 226, 226); font-size:5em">08</span><br>
                <span style="color:rgb(235, 226, 226); font-size:1.4em">Công ty ABC</span><br><br><br><br>
              </div>

            </div>
            <div class="col-md-2 text-center ">
              <div class="statistic2">
                <span style="color:rgb(235, 226, 226); font-size:5em">08</span><br>
                <span style="color:#ff6215; font-size:1.4em">Công ty XYZ</span><br><br><br><br>
              </div>

            </div>
            <div class="col-md-4">
              <img src="..\ctsa-capstone\images\nest.svg"
                   alt="Nest"
                   height="60"
                   width="150"><br>
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
                dolore magna aliqua.</p>

            </div>
          </div>
          <div class="row">
            <div class="col-md-4"
                 style="text-align: right">
              <img src="..\ctsa-capstone\images\javascript.png"
                   alt="javascript"
                   height="60"
                   width="150"><br>
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
                dolore magna aliqua.</p>

            </div>
            <div class="col-md-2 text-center ">
              <div class="statistic1">
                <span style="color:rgb(235, 226, 226); font-size:5em">05</span><br>
                <span style="color:rgb(235, 226, 226); font-size:1.4em">Công ty Hải</span><br><br><br><br>
              </div>

            </div>
            <div class="col-md-2 text-center ">
              <div class="statistic2">
                <span style="color:rgb(235, 226, 226); font-size:5em">002</span><br>
                <span style="color:#ff6215; font-size:1.4em">Công ty Fsoft</span><br><br><br><br>
              </div>

            </div>
            <div class="col-md-4">
              <img src="..\ctsa-capstone\images\node-js.png"
                   alt="NodeJS"
                   height="60"
                   width="150"><br>
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
                dolore magna aliqua.</p>
            </div>
          </div>
        </div>

        <div class="tab-pane fade "
             id="recruit"
             role="tabpanel"
             aria-labelledby="contact-tab">

          <div class="row justify-content-center ">

            <div class="col-md-3 text-center banner ">
              <span style="font-size: 55px; color:#ff6414">2</span>
              <br><br>
              <b style="color:rgb(241, 236, 236); font-size:3em">Amazon</b><br>
              <img src="..\web-ui\images\companyA.png"
                   alt="Hình công ty"
                   height="120"
                   width="220"
                   class="img-recruitment">
              <div class="info-recruitment">
                <h3> 15 vị trí</h3>
                <h3>Đang tuyển dụng</h3>
              </div>

            </div>

            <div class="col-md-4 text-center banner"
                 style="height:700px; width:280px;">
              <span style="font-size: 70px; color:#ff6414">1</span><br><br>
              <b style="color:rgb(241, 236, 236); font-size:5em">Grab</b><br>
              <img src="..\web-ui\images\companyB.svg"
                   alt="Hình công ty"
                   height="140"
                   width="240"
                   class="img-recruitment">
              <div class="info-recruitment">
                <h3> 15 vị trí</h3>
                <h3>Đang tuyển dụng</h3>
              </div>

            </div>

            <div class="col-md-3 text-center banner">

              <span style="font-size: 55px; color:#ff6414">3</span><br><br>
              <b style="color:rgb(241, 236, 236); font-size:3em">RXR</b><br>
              <img src="..\web-ui\images\companyC.png"
                   alt="Hình công ty"
                   height="120"
                   width="220"
                   class="img-recruitment">
              <div class="info-recruitment">
                <h3> 15 vị trí</h3>
                <h3>Đang tuyển dụng</h3>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Modal -->
  <div class="modal fade rounded"
       id="skillModal"
       tabindex="-1"
       role="dialog"
       aria-labelledby="skillModalLabel"
       aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xm"
         role="document">
      <div class="modal-content">
        <div class="pt-3 pb-2 bg-orange text-white text-center shadow "
             style="border-top-left-radius: 20px ; 
        border-top-right-radius: 20px !important; ">
          <h4>Xếp hạng</h4>

        </div>
        <div class="row modal-body justify-content-between">
          <table class="table table-bordered">
            <thead>
              <tr>
                <th scope="col"
                    class="text-center">#</th>
                <th scope="col">Tên skill</th>

              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row"
                    class="text-center">1</th>
                <td>Mark</td>

              </tr>
              <tr>
                <th scope="row"
                    class="text-center">2</th>
                <td>Jacob</td>

              </tr>
              <tr>
                <th scope="row"
                    class="text-center">3</th>
                <td>Larry the Bird</td>

              </tr>
            </tbody>
          </table>
        </div>
        <div class="modal-footer justify-content-center">

          <ul class="pagination ">
            <li class="page-item">
              <a class="page-link"
                 href="#"
                 aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
                <span class="sr-only">Previous</span>
              </a>
            </li>
            <li class="page-item"><a class="page-link pagi-button-selected"
                 href="#">1</a></li>
            <li class="page-item"><a class="page-link"
                 href="#">2</a></li>
            <li class="page-item"><a class="page-link"
                 href="#">3</a></li>
            <li class="page-item">
              <a class="page-link"
                 href="#"
                 aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
                <span class="sr-only">Next</span>
              </a>
            </li>
          </ul>

        </div>
      </div>
    </div>
  </div>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
  <script>
    $("#tabhome").click(function () {
      $(this).addClass("tabactive");
      $("#tabstat").removeClass("tabactive");
      $("#tabrecruit").removeClass("tabactive");
    });
    $("#tabstat").click(function () {
      $(this).addClass("tabactive");
      $("#tabhome").removeClass("tabactive");
      $("#tabrecruit").removeClass("tabactive");
    });
    $("#tabrecruit").click(function () {
      $(this).addClass("tabactive");
      $("#tabhome").removeClass("tabactive");
      $("#tabstat").removeClass("tabactive");
    });

    window.onload = async function () {
      let position = JSON.parse(sessionStorage.getItem('position'))

      let homeDiv = $('#home')
      homeDiv.empty()
      $('<h3>', {
        class: 'text-center',
        style: 'margin-top: 1%',
        html: 'Top các nhóm kỹ năng thông dụng nhất cho vị trí<br><h1 style="font-weight: bold; margin-top: 1%">' + position.name + '</h1>'
      }).appendTo(homeDiv)

      let skillTypes = []
      let response
      if (position.mainSkillTypeId !== null) {
        skillTypes.push(position.mainSkillTypeId)
        response = await axios.get("http://localhost:8003/required_skills/position_id=" + position.id + "/top-skill-types?escape-skill-type-id=" + position.mainSkillTypeId)
      } else {
        response = await axios.get("http://localhost:8003/required_skills/position_id=" + position.id + "/top-skill-types")
      }

      let topSkills = []

      // let response = await axios.get("http://localhost:8001/skill-types?business-field-id=1")

      for (let skillType of response.data) {
        skillTypes.push(skillType)
      }

      let count = 0
      for (let skillType of skillTypes) {
        let skills = await getITSoftwareTrendByPositionAndSkillType(position.id, skillType);

        if (skills) {
          topSkills.push({
            skillTypeId: skillType,
            skills: skills
          })
        }
      }

      count = 0
      for (let skillsWithType of topSkills) {
        if (count % 2 === 0) {
          generateUI(skillsWithType.skills, 'left')
        } else {
          generateUI(skillsWithType.skills, 'right')
        }
        count++
      }
    }

    async function getITSoftwareTrendByPositionAndSkillType(positionId, skillTypeId) {
      let ids = []
      let response = await axios.get('http://localhost:8003/required_skills/top?position_id=' + positionId + '&skill_type_id=' + skillTypeId);
      if (response) {
        await response.data.forEach((id) => {
          ids.push(id)
        });
        if (ids.length > 0) {
          let postData = await axios.post('http://localhost:8001/skills/list', ids)
          return postData.data
        }
      }

      return null
    }

    function generateUI(skills, direction) {
      let homeDiv = $('#home')

      if (direction === 'left') {
        let banner = $('<div>', {
          class: "col-md-9 top-3 top-left"
        })

        let row = $('<div>', {
          class: "row justify-content-between"
        })

        let skillTypeName = $('<div>', {
          class: "col-md-5 my-auto pl-5"
        })

        $('<b>', {
          style: "color: white; font-size: 40px;font-style: italic",
          html: "TOP<br>" + skills[0].skillType.vietnamese
        }).appendTo(skillTypeName)

        skillTypeName.appendTo(row)

        let skillItems = $('<div>', {
          class: "col-md-6 row justify-content-around top-icons-left"
        })

        for (let i = 0; i < 3; i++) {
          if (skills[i]) {
            let skillItem = $('<div>', {
              class: "col-md-3 text-center",
              style: "font-size: 1.1em; font-weight: bold"
            })

            $('<img>', {
              src: skills[i].imageUrl
            }).appendTo(skillItem)
            skillItem.append(skills[i].vietnamese)

            skillItem.appendTo(skillItems)
          }
        }

        skillItems.appendTo(row)
        row.appendTo(banner)
        banner.appendTo(homeDiv)

        $('<div>', {
          class: "left-triangle"
        }).appendTo(homeDiv)
      } else {
        let banner = $('<div>', {
          class: "col-md-9 top-3 top-right"
        })

        let row = $('<div>', {
          class: "row justify-content-between"
        })

        let skillItems = $('<div>', {
          class: "col-md-6 row justify-content-around top-icons-left"
        })

        for (let i = 0; i < 3; i++) {
          if (skills[i]) {
            let skillItem = $('<div>', {
              class: "col-md-3 text-center",
              style: "font-size: 1.1em; font-weight: bold"
            })

            $('<img>', {
              src: skills[i].imageUrl
            }).appendTo(skillItem)
            skillItem.append(skills[i].vietnamese)

            skillItem.appendTo(skillItems)
          }
        }

        skillItems.appendTo(row)
        let skillTypeName = $('<div>', {
          class: "col-md-5 my-auto pl-5"
        })

        $('<b>', {
          style: "color: white; font-size: 40px;font-style: italic",
          html: "TOP<br>" + skills[0].skillType.vietnamese
        }).appendTo(skillTypeName)
        skillTypeName.appendTo(row)

        row.appendTo(banner)

        banner.appendTo(homeDiv)

        $('<div>', {
          class: "right-triangle"
        }).appendTo(homeDiv)
      }
    }
  </script>
</body>

</html>